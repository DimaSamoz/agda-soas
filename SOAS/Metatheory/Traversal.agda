
open import SOAS.Common
open import SOAS.Families.Core
open import Categories.Object.Initial
open import SOAS.Coalgebraic.Strength
import SOAS.Metatheory.MetaAlgebra

-- Traversals parametrised by a pointed coalgebra
module SOAS.Metatheory.Traversal {T : Set}
  (â…€F : Functor ğ”½amiliesâ‚› ğ”½amiliesâ‚›) (â…€:Str : Strength â…€F)
  (ğ”› : Familyâ‚›) (open SOAS.Metatheory.MetaAlgebra â…€F ğ”›)
  (ğ•‹:Init : Initial ğ•„etaAlgebras)
  where

open import SOAS.Context
open import SOAS.Variable
open import SOAS.Abstract.Hom
import SOAS.Abstract.Coalgebra as â†’â–¡ ; open â†’â–¡.Sorted
import SOAS.Abstract.Box as â–¡ ; open â–¡.Sorted

open import SOAS.Metatheory.Algebra â…€F
open import SOAS.Metatheory.Semantics â…€F â…€:Str ğ”› ğ•‹:Init

open Strength â…€:Str

private
  variable
    Î“ Î” Î˜ Î  : Ctx
    Î± Î² : T
    ğ’« ğ’¬ ğ’œ : Familyâ‚›


-- Parametrised interpretation into an internal hom
module Traversal (ğ’«á´® : Coalgâ‚š ğ’«)(ğ‘ğ‘™ğ‘” : â…€ ğ’œ â‡¾Ì£ ğ’œ)
                 (Ï† : ğ’« â‡¾Ì£ ğ’œ)(Ï‡ : ğ”› â‡¾Ì£ ã€– ğ’œ , ğ’œ ã€—) where

  open Coalgâ‚š ğ’«á´®

  -- Under the assumptions ğ’œ and ã€– ğ’« , ğ’œ ã€— are both meta-algebras
  ğ’œáµƒ : MetaAlg ğ’œ
  ğ’œáµƒ = record { ğ‘ğ‘™ğ‘” = ğ‘ğ‘™ğ‘” ; ğ‘£ğ‘ğ‘Ÿ = Î» x â†’ Ï† (Î· x) ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Ï‡ }

  Traváµƒ : MetaAlg ã€– ğ’« , ğ’œ ã€—
  Traváµƒ = record
    { ğ‘ğ‘™ğ‘”  = Î» t Ïƒ â†’ ğ‘ğ‘™ğ‘” (str ğ’«á´® ğ’œ t Ïƒ)
    ; ğ‘£ğ‘ğ‘Ÿ  = Î» x Ïƒ â†’ Ï† (Ïƒ x)
    ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Î» ğ”ª Îµ Ïƒ â†’ Ï‡ ğ”ª (Î» ğ”« â†’ Îµ ğ”« Ïƒ)
    }

  -- ã€– ğ’« , ğ’œ ã€— is also a pointed â–¡-coalgebra
  Traváµ‡ : Coalg ã€– ğ’« , ğ’œ ã€—
  Traváµ‡ = record { r = Î» h Ï Ïƒ â†’ h (Ïƒ âˆ˜ Ï) ; counit = refl ; comult = refl }

  Travá´® : Coalgâ‚š ã€– ğ’« , ğ’œ ã€—
  Travá´® = record { áµ‡ = Traváµ‡ ; Î· = Î» x Ïƒ â†’ Ï† (Ïƒ x) ; râˆ˜Î· = refl }

  open Semantics Traváµƒ public renaming (ğ•¤ğ•–ğ• to ğ•¥ğ•£ğ•’ğ•§)

  -- Traversal-specific homomorphism properties that incorporate a substitution
  ğ•¥âŸ¨ğ•§âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{x : â„ Î± Î“} â†’ ğ•¥ğ•£ğ•’ğ•§ (ğ•§ğ•’ğ•£ x) Ïƒ â‰¡ Ï† (Ïƒ x)
  ğ•¥âŸ¨ğ•§âŸ© {Ïƒ = Ïƒ} = cong (Î» - â†’ - Ïƒ) âŸ¨ğ•§âŸ©

  ğ•¥âŸ¨ğ•âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
       â†’ ğ•¥ğ•£ğ•’ğ•§ (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) Ïƒ â‰¡ Ï‡ ğ”ª (Î» p â†’ ğ•¥ğ•£ğ•’ğ•§ (Îµ p) Ïƒ)
  ğ•¥âŸ¨ğ•âŸ© {Ïƒ = Ïƒ} = cong (Î» - â†’ - Ïƒ) âŸ¨ğ•âŸ©

  ğ•¥âŸ¨ğ•’âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{t : â…€ ğ•‹ Î± Î“}
       â†’ ğ•¥ğ•£ğ•’ğ•§ (ğ•’ğ•ğ•˜ t) Ïƒ â‰¡ ğ‘ğ‘™ğ‘” (str ğ’«á´® ğ’œ (â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t) Ïƒ)
  ğ•¥âŸ¨ğ•’âŸ© {Ïƒ = Ïƒ} = cong (Î» - â†’ - Ïƒ) âŸ¨ğ•’âŸ©

  -- Congruence in the two arguments of ğ•¥ğ•£ğ•’ğ•§
  ğ•¥â‰ˆâ‚ : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{tâ‚ tâ‚‚ : ğ•‹ Î± Î“} â†’ tâ‚ â‰¡ tâ‚‚ â†’ ğ•¥ğ•£ğ•’ğ•§ tâ‚ Ïƒ â‰¡ ğ•¥ğ•£ğ•’ğ•§ tâ‚‚ Ïƒ
  ğ•¥â‰ˆâ‚ {Ïƒ = Ïƒ} p = cong (Î» - â†’ ğ•¥ğ•£ğ•’ğ•§ - Ïƒ) p

  ğ•¥â‰ˆâ‚‚ : {Ïƒâ‚ Ïƒâ‚‚ : Î“ ~[ ğ’« ]â† Î”}{t : ğ•‹ Î± Î“}
      â†’ ({Ï„ : T}{x : â„ Ï„ Î“} â†’ Ïƒâ‚ x â‰¡ Ïƒâ‚‚ x)
      â†’ ğ•¥ğ•£ğ•’ğ•§ t Ïƒâ‚ â‰¡ ğ•¥ğ•£ğ•’ğ•§ t Ïƒâ‚‚
  ğ•¥â‰ˆâ‚‚ {t = t} p = cong (ğ•¥ğ•£ğ•’ğ•§ t) (dextâ€² p)


-- A pointed meta-Î›-algebra induces ğ•’ğ•ğ•˜ traversal into â–¡ ğ’œ
module â–¡Traversal {ğ’œ} (ğ’œáµƒ : MetaAlg ğ’œ) =
  Traversal â„á´® (MetaAlg.ğ‘ğ‘™ğ‘” ğ’œáµƒ) (MetaAlg.ğ‘£ğ‘ğ‘Ÿ ğ’œáµƒ) (MetaAlg.ğ‘šğ‘£ğ‘ğ‘Ÿ ğ’œáµƒ)

-- Corollary: â–¡ lifts to an endofunctor on pointed meta-Î›-algebras
â–¡áµƒ : (ğ’œáµƒ : MetaAlg ğ’œ) â†’ MetaAlg (â–¡ ğ’œ)
â–¡áµƒ = â–¡Traversal.Traváµƒ

-- Helper records for proving equality of maps f, g out of ğ•‹,
-- with 0, 1 or 2 parameters
record MapEqâ‚€ (ğ’œ : Familyâ‚›)(f g : ğ•‹ â‡¾Ì£ ğ’œ) : Set where
  field
    áµƒ : MetaAlg ğ’œ
  open Semantics áµƒ
  open ğ’œ

  field
    fâŸ¨ğ‘£âŸ© : {x : â„ Î± Î“}
         â†’ f (ğ•§ğ•’ğ•£ x) â‰¡ ğ‘£ğ‘ğ‘Ÿ x
    fâŸ¨ğ‘šâŸ© : {ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ f (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) â‰¡ ğ‘šğ‘£ğ‘ğ‘Ÿ ğ”ª (f âˆ˜ Îµ)
    fâŸ¨ğ‘âŸ© : {t : â…€ ğ•‹ Î± Î“}
         â†’ f (ğ•’ğ•ğ•˜ t) â‰¡ ğ‘ğ‘™ğ‘” (â…€â‚ f t)
    gâŸ¨ğ‘£âŸ© : {x : â„ Î± Î“}
         â†’ g (ğ•§ğ•’ğ•£ x) â‰¡ ğ‘£ğ‘ğ‘Ÿ x
    gâŸ¨ğ‘šâŸ© : {ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ g (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) â‰¡ ğ‘šğ‘£ğ‘ğ‘Ÿ ğ”ª (g âˆ˜ Îµ)
    gâŸ¨ğ‘âŸ© : {t : â…€ ğ•‹ Î± Î“}
         â†’ g (ğ•’ğ•ğ•˜ t) â‰¡ ğ‘ğ‘™ğ‘” (â…€â‚ g t)

  fáµƒ : MetaAlgâ‡’ ğ•‹áµƒ áµƒ f
  fáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© =  fâŸ¨ğ‘âŸ© ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© =  fâŸ¨ğ‘£âŸ© ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© =  fâŸ¨ğ‘šâŸ© }
  gáµƒ : MetaAlgâ‡’ ğ•‹áµƒ áµƒ g
  gáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© =  gâŸ¨ğ‘âŸ© ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© =  gâŸ¨ğ‘£âŸ© ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© =  gâŸ¨ğ‘šâŸ© }

  â‰ˆ : (t : ğ•‹ Î± Î“) â†’ f t â‰¡ g t
  â‰ˆ t = eq fáµƒ gáµƒ t

record MapEqâ‚ (ğ’«á´® : Coalgâ‚š ğ’«)(ğ‘ğ‘™ğ‘” : â…€ ğ’œ â‡¾Ì£ ğ’œ)
              (f g : ğ•‹ â‡¾Ì£ ã€– ğ’« , ğ’œ ã€—) : Set where
  field
    Ï† : ğ’« â‡¾Ì£ ğ’œ
    Ï‡ : ğ”› â‡¾Ì£ ã€– ğ’œ , ğ’œ ã€—

  open Traversal ğ’«á´® ğ‘ğ‘™ğ‘” Ï† Ï‡

  field
    fâŸ¨ğ‘£âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{x : â„ Î± Î“}
         â†’ f (ğ•§ğ•’ğ•£ x) Ïƒ â‰¡ Ï† (Ïƒ x)
    fâŸ¨ğ‘šâŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ f (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) Ïƒ â‰¡ Ï‡ ğ”ª (Î» p â†’ f (Îµ p) Ïƒ)
    fâŸ¨ğ‘âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{t : â…€ ğ•‹ Î± Î“}
         â†’ f (ğ•’ğ•ğ•˜ t) Ïƒ â‰¡ ğ‘ğ‘™ğ‘” (str ğ’«á´® ğ’œ (â…€â‚ f t) Ïƒ)
    gâŸ¨ğ‘£âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{x : â„ Î± Î“}
         â†’ g (ğ•§ğ•’ğ•£ x) Ïƒ â‰¡ Ï† (Ïƒ x)
    gâŸ¨ğ‘šâŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ g (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) Ïƒ â‰¡ Ï‡ ğ”ª (Î» p â†’ g (Îµ p) Ïƒ)
    gâŸ¨ğ‘âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{t : â…€ ğ•‹ Î± Î“}
         â†’ g (ğ•’ğ•ğ•˜ t) Ïƒ â‰¡ ğ‘ğ‘™ğ‘” (str ğ’«á´® ğ’œ (â…€â‚ g t) Ïƒ)

  fáµƒ : MetaAlgâ‡’ ğ•‹áµƒ Traváµƒ f
  fáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = dextâ€² fâŸ¨ğ‘âŸ© ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² fâŸ¨ğ‘£âŸ© ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² fâŸ¨ğ‘šâŸ© }
  gáµƒ : MetaAlgâ‡’ ğ•‹áµƒ Traváµƒ g
  gáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = dextâ€² gâŸ¨ğ‘âŸ© ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² gâŸ¨ğ‘£âŸ© ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² gâŸ¨ğ‘šâŸ© }

  â‰ˆ : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}(t : ğ•‹ Î± Î“) â†’ f t Ïƒ â‰¡ g t Ïƒ
  â‰ˆ {Ïƒ = Ïƒ} t = cong (Î» - â†’ - Ïƒ) (eq fáµƒ gáµƒ t)

record MapEqâ‚‚ (ğ’«á´® : Coalgâ‚š ğ’«)(ğ’¬á´® : Coalgâ‚š ğ’¬)(ğ‘ğ‘™ğ‘” : â…€ ğ’œ â‡¾Ì£ ğ’œ)
                (f g : ğ•‹ â‡¾Ì£ ã€– ğ’« , ã€– ğ’¬ , ğ’œ ã€— ã€—) : Set where
  field
    Ï† : ğ’¬ â‡¾Ì£ ğ’œ
    Ï• : ğ’« â‡¾Ì£ ã€– ğ’¬ , ğ’œ ã€—
    Ï‡ : ğ”› â‡¾Ì£ ã€– ğ’œ , ğ’œ ã€—

  open Traversal ğ’«á´® (Traversal.ğ’œ.ğ‘ğ‘™ğ‘” ğ’¬á´® ğ‘ğ‘™ğ‘” Ï† Ï‡) Ï• (Î» ğ”ª Îµ Ïƒ â†’ Ï‡ ğ”ª (Î» ğ”« â†’ Îµ ğ”« Ïƒ))

  field
    fâŸ¨ğ‘£âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{x : â„ Î± Î“}
         â†’ f (ğ•§ğ•’ğ•£ x) Ïƒ Ï‚ â‰¡ Ï• (Ïƒ x) Ï‚
    fâŸ¨ğ‘šâŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ f (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) Ïƒ Ï‚ â‰¡ Ï‡ ğ”ª (Î» ğ”« â†’ f (Îµ ğ”«) Ïƒ Ï‚)
    fâŸ¨ğ‘âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{t : â…€ ğ•‹ Î± Î“}
         â†’ f (ğ•’ğ•ğ•˜ t) Ïƒ Ï‚ â‰¡ ğ‘ğ‘™ğ‘” (str ğ’¬á´® ğ’œ (str ğ’«á´® ã€– ğ’¬ , ğ’œ ã€— (â…€â‚ f t) Ïƒ) Ï‚)
    gâŸ¨ğ‘£âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{x : â„ Î± Î“}
         â†’ g (ğ•§ğ•’ğ•£ x) Ïƒ Ï‚ â‰¡ Ï• (Ïƒ x) Ï‚
    gâŸ¨ğ‘šâŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{ğ”ª : ğ”› Î± Î }{Îµ : Î  ~[ ğ•‹ ]â† Î“}
         â†’ g (ğ•ğ•§ğ•’ğ•£ ğ”ª Îµ) Ïƒ Ï‚ â‰¡ Ï‡ ğ”ª (Î» ğ”« â†’ g (Îµ ğ”«) Ïƒ Ï‚)
    gâŸ¨ğ‘âŸ© : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}{t : â…€ ğ•‹ Î± Î“}
         â†’ g (ğ•’ğ•ğ•˜ t) Ïƒ Ï‚ â‰¡ ğ‘ğ‘™ğ‘” (str ğ’¬á´® ğ’œ (str ğ’«á´® ã€– ğ’¬ , ğ’œ ã€— (â…€â‚ g t) Ïƒ) Ï‚)

  fáµƒ : MetaAlgâ‡’ ğ•‹áµƒ Traváµƒ f
  fáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = dextâ€² (dextâ€² fâŸ¨ğ‘âŸ©) ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² (dextâ€² fâŸ¨ğ‘£âŸ©)
              ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² (dextâ€² fâŸ¨ğ‘šâŸ©) }
  gáµƒ : MetaAlgâ‡’ ğ•‹áµƒ Traváµƒ g
  gáµƒ = record { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = dextâ€² (dextâ€² gâŸ¨ğ‘âŸ©) ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² (dextâ€² gâŸ¨ğ‘£âŸ©)
              ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = dextâ€² (dextâ€² gâŸ¨ğ‘šâŸ©) }

  â‰ˆ : {Ïƒ : Î“ ~[ ğ’« ]â† Î”}{Ï‚ : Î” ~[ ğ’¬ ]â† Î˜}(t : ğ•‹ Î± Î“) â†’ f t Ïƒ Ï‚ â‰¡ g t Ïƒ Ï‚
  â‰ˆ {Ïƒ = Ïƒ}{Ï‚} t = cong (Î» - â†’ - Ïƒ Ï‚) (eq fáµƒ gáµƒ t)

-- Interaction of traversal and interpretation
module _ (ğ’«á´® : Coalgâ‚š ğ’«)(ğ’œáµƒ : MetaAlg ğ’œ)(Ï† : ğ’« â‡¾Ì£ ğ’œ) where
  open MetaAlg ğ’œáµƒ
  open Coalgâ‚š ğ’«á´®
  open Semantics ğ’œáµƒ
  open Traversal ğ’«á´® ğ‘ğ‘™ğ‘” Ï† ğ‘šğ‘£ğ‘ğ‘Ÿ using (ğ•¥ğ•£ğ•’ğ•§ ; ğ•¥âŸ¨ğ•’âŸ© ; ğ•¥âŸ¨ğ•§âŸ© ; ğ•¥âŸ¨ğ•âŸ©)
  open â‰¡-Reasoning

  -- Traversal with the point of ğ’« is the same as direct interpretation
  ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆğ•¤ğ•–ğ• : (Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ : âˆ€{Î± Î“}{v : â„ Î± Î“} â†’ Ï† (Î· v) â‰¡ ğ‘£ğ‘ğ‘Ÿ v){t : ğ•‹ Î± Î“}
        â†’ ğ•¥ğ•£ğ•’ğ•§ t Î· â‰¡ ğ•¤ğ•–ğ• t
  ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆğ•¤ğ•–ğ• Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ {t = t} = Semantics.eq ğ’œáµƒ (record
    { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = Î»{ {t = t} â†’ trans ğ•¥âŸ¨ğ•’âŸ© (cong ğ‘ğ‘™ğ‘” (begin
          str ğ’«á´® ğ’œ (â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t) Î·
      â‰¡âŸ¨ str-natâ‚ (Î·á´®â‡’ ğ’«á´®) (â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t) id âŸ©
          str â„á´® ğ’œ (â…€â‚ (Î»{ h Ï â†’ h (Î· âˆ˜ Ï)}) ((â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t))) id
      â‰¡âŸ¨ str-unit ğ’œ ((â…€â‚ (Î»{ h Ï â†’ h (Î· âˆ˜ Ï)}) ((â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t)))) âŸ©
          â…€â‚ (i ğ’œ) (â…€â‚ (Î» { h Ï â†’ h (Î· âˆ˜ Ï) }) (â…€â‚ ğ•¥ğ•£ğ•’ğ•§ t))
      â‰¡Ë˜âŸ¨ trans â…€.homomorphism â…€.homomorphism âŸ©
          â…€â‚ (Î» t â†’ ğ•¥ğ•£ğ•’ğ•§ t Î·) t
      âˆ))}
    ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = Î»{ {v = v} â†’ trans ğ•¥âŸ¨ğ•§âŸ© Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ }
    ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = Î»{ {ğ”ª}{Îµ} â†’ ğ•¥âŸ¨ğ•âŸ© } }) ğ•¤ğ•–ğ•áµƒâ‡’ t

-- Traversal with the point of ğ’« into ğ•‹  is the identity
ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆid : (ğ’«á´® : Coalgâ‚š ğ’«)(open Coalgâ‚š ğ’«á´®)(Ï† : ğ’« â‡¾Ì£ ğ•‹)
          (Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ : âˆ€{Î± Î“}{v : â„ Î± Î“} â†’ Ï† (Î· v) â‰¡ ğ•§ğ•’ğ•£ v){t : ğ•‹ Î± Î“}
         â†’ Traversal.ğ•¥ğ•£ğ•’ğ•§ ğ’«á´® ğ•’ğ•ğ•˜ Ï† ğ•ğ•§ğ•’ğ•£ t Î· â‰¡ t
ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆid ğ’«á´® Ï† Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ = trans (ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆğ•¤ğ•–ğ• ğ’«á´® ğ•‹áµƒ Ï† Ï†âˆ˜Î·â‰ˆğ‘£ğ‘ğ‘Ÿ) ğ•¤ğ•–ğ•-id

-- Corollaries for â„-parametrised traversals
â–¡ğ•¥ğ•£ğ•’ğ•§-idâ‰ˆğ•¤ğ•–ğ• : (ğ’œáµƒ : MetaAlgÂ ğ’œ){t : ğ•‹ Î± Î“}
            â†’ â–¡Traversal.ğ•¥ğ•£ğ•’ğ•§ ğ’œáµƒ t id â‰¡ Semantics.ğ•¤ğ•–ğ• ğ’œáµƒ t
â–¡ğ•¥ğ•£ğ•’ğ•§-idâ‰ˆğ•¤ğ•–ğ• ğ’œáµƒ {t} = ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆğ•¤ğ•–ğ• â„á´® ğ’œáµƒ (MetaAlg.ğ‘£ğ‘ğ‘Ÿ ğ’œáµƒ) refl

â–¡ğ•¥ğ•£ğ•’ğ•§-idâ‰ˆid : {t : ğ•‹ Î± Î“} â†’ â–¡Traversal.ğ•¥ğ•£ğ•’ğ•§ ğ•‹áµƒ t id â‰¡ t
â–¡ğ•¥ğ•£ğ•’ğ•§-idâ‰ˆid = ğ•¥ğ•£ğ•’ğ•§-Î·â‰ˆid â„á´® ğ•§ğ•’ğ•£ refl
