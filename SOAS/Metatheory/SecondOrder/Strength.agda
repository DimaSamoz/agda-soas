
open import SOAS.Metatheory.Syntax

-- Linear strength for term functor
module SOAS.Metatheory.SecondOrder.Strength {T : Set}(Syn : Syntax {T}) where

open Syntax Syn

open import SOAS.Metatheory.FreeMonoid Syn
open import SOAS.Metatheory.TermFunctor Syn

open import SOAS.Common
open import SOAS.Families.Core {T}
open import SOAS.Context
open import SOAS.Variable
open import SOAS.ContextMaps.Combinators
open import SOAS.ContextMaps.CategoryOfRenamings
open import SOAS.ContextMaps.Properties

open import SOAS.Abstract.Hom
import SOAS.Abstract.Box as â–¡ ; open â–¡.Sorted
import SOAS.Abstract.Coalgebra as â†’â–¡ ; open â†’â–¡.Sorted

open import SOAS.Metatheory Syn

open import SOAS.Linear.Tensor
open import SOAS.Linear.Exponential
open import SOAS.Linear.Strength
open import SOAS.Linear.Distributor

open Theory using (ğ•‹ ; SynAlg ; module Semantics ; ğ•‹áµ‡ ; ğ•‹áµƒ ; ğ•‹áµ ; ğ•£ğ•–ğ•Ÿ)

private
  variable
    X Y : Family
    ğ’³ ğ’´ ğ’µ ğ’œ â„³ : Familyâ‚›
    Î“ Î” Î˜ Î Î  : Ctx
    Î± Ï„ : T

-- Functorial action on metavariable family
SynAlgâ‚ : (f : ğ’³ â‡¾Ì£ ğ’´) â†’ SynAlg ğ’´ ğ’œ â†’ SynAlg ğ’³ ğ’œ
SynAlgâ‚ {ğ’³}{ğ’´} f ğ’œáµƒ = record { ğ‘ğ‘™ğ‘” = ğ‘ğ‘™ğ‘” ; ğ‘£ğ‘ğ‘Ÿ = ğ‘£ğ‘ğ‘Ÿ ; ğ‘šğ‘£ğ‘ğ‘Ÿ = ğ‘šğ‘£ğ‘ğ‘Ÿ âˆ˜ f }
  where open SynAlg ğ’´ ğ’œáµƒ

-- If ğ’œ is a (Î£, ğ’´)-syntactic algebra, X âŠ¸ ğ’´ is a (Î£, X âŠ¸ ğ’´)-syntactic algebra
LinParamáµƒ : SynAlg ğ’´ ğ’œ â†’ SynAlg (X âŠ¸ ğ’´) (X âŠ¸ ğ’œ)
LinParamáµƒ {ğ’´}{ğ’œ}{X} ğ’œáµƒ = record
  { ğ‘ğ‘™ğ‘” = Î» t x â†’ ğ‘ğ‘™ğ‘” (lstr ğ’œ t x)
  ; ğ‘£ğ‘ğ‘Ÿ = Î» v y â†’ ğ‘£ğ‘ğ‘Ÿ (ÎºÂ° X v y)
  ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Î» ğ”© â†’ dist X ğ‘£ğ‘ğ‘Ÿ ğ’œ (ğ‘šğ‘£ğ‘ğ‘Ÿ âˆ˜ ğ”©)
  } where open SynAlg ğ’´ ğ’œáµƒ

module LinParam {X}{ğ’œ}{ğ’´} (ğ’œáµƒ : SynAlg ğ’´ ğ’œ) = Semantics (X âŠ¸ ğ’´) (LinParamáµƒ ğ’œáµƒ)

-- Special case: linear strength for ğ•‹
module ğ•ƒğ•Šğ•¥ğ•£ {X}{ğ’´} = LinParam {X} (ğ•‹áµƒ ğ’´)

ğ•ğ•¤ğ•¥ğ•£ : ğ•‹ (X âŠ¸ ğ’´) â‡¾Ì£ (X âŠ¸ ğ•‹ ğ’´)
ğ•ğ•¤ğ•¥ğ•£Â = ğ•ƒğ•Šğ•¥ğ•£.ğ•¤ğ•–ğ•

open Theory

-- Homomorphism conditions for strength
ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© : (v : â„ Î± Î“){x : X Î”}
      â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) x
      â‰¡ ğ•§ğ•’ğ•£ ğ’´ (ÎºÂ° X v x)
ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v {x} = cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•§âŸ© {v = v})

ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© : (t : â…€ (ğ•‹ (X âŠ¸ ğ’´)) Î± Î“){x : X Î”}
      â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) t) x
      â‰¡ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x)
ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© t {x} = cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•’âŸ© {t = t})

ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© : (ğ”© : (X âŠ¸ ğ’´) Î± Î )(Îµ : Î  ~[ ğ•‹ (X âŠ¸ ğ’´) ]â† Î“){x : X Î”}
      â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) ğ”© Îµ) x
      â‰¡ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x
ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© ğ”© Îµ {x} = cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•âŸ© {ğ”ª = ğ”©}{Îµ})


ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ : {t s : ğ•‹ (X âŠ¸ ğ’´) Î± Î“}{x : X Î”} (tâ‰¡s : t â‰¡ s)
     â†’ ğ•ğ•¤ğ•¥ğ•£ {X}{ğ’´} t x â‰¡ ğ•ğ•¤ğ•¥ğ•£ s x
ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ refl = refl


-- Strength is a coalgebra homomorphism
ğ•ğ•¤ğ•¥ğ•£áµ‡â‡’ : Coalgâ‡’ (ğ•‹áµ‡ (X âŠ¸ ğ’´)) (X âŠ¸áµ‡ ğ•‹áµ‡ ğ’´) ğ•ğ•¤ğ•¥ğ•£
ğ•ğ•¤ğ•¥ğ•£áµ‡â‡’ {X}{ğ’´} = ğ•¤ğ•–ğ•áµ‡â‡’ (X âŠ¸ ğ’´) (X âŠ¸áµ‡ ğ•‹áµ‡ ğ’´) (LinParamáµƒ (ğ•‹áµƒ ğ’´)) (record
  -- https://tinyurl.com/y7bpch95
  { âŸ¨ğ‘ğ‘™ğ‘”âŸ© = Î»{ {t = t} â†’ dextÂ² Î» Ï {Î˜} x â†’ begin
        âŠ¸â–¡ (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ ğ•’ğ•ğ•˜ ğ’´ âˆ˜ lstr (ğ•‹ ğ’´) t) Ï x
    â‰¡âŸ¨ Renaming.ğ•¥âŸ¨ğ•’âŸ© ğ’´ âŸ©
        âŠ¸â–¡ (ğ•‹ ğ’´) (Î» x Ï â†’ ğ•’ğ•ğ•˜ ğ’´ (str â„á´® (ğ•‹ ğ’´) (â…€â‚ (ğ•£ğ•–ğ•Ÿ ğ’´) (lstr (ğ•‹ ğ’´) t x)) Ï)) Ï x
    â‰¡Ë˜âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (strâ‰ˆâ‚ (lstr-natâ‚‚ (ğ•£ğ•–ğ•Ÿ ğ’´) t x)) âŸ© --(strâ‰ˆâ‚ (lstr-natâ‚‚ (ğ•‹áµ‡ ğ’´) (â–¡áµ‡ (ğ•‹ ğ’´)) ráµ‡â‡’ t x)) âŸ©
        âŠ¸â–¡ (ğ•‹ ğ’´) (Î» x Ï â†’ ğ•’ğ•ğ•˜ ğ’´ (str â„á´® (ğ•‹ ğ’´) (lstr (â–¡ (ğ•‹ ğ’´)) (â…€â‚ {X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ â–¡ (ğ•‹ ğ’´)} (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜_) t) x) Ï)) Ï x
    â‰¡âŸ¨âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (âŠ¸â–¡ (â…€ (ğ•‹ ğ’´)) (Î» x Ï â†’ str â„á´® (ğ•‹ ğ’´) (lstr (â–¡ (ğ•‹ ğ’´)) (â…€â‚ {X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ â–¡ (ğ•‹ ğ’´)} (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜_) t) x) Ï) Ï x)
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (compat-strs â„á´® (â…€â‚ {X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ â–¡ (ğ•‹ ğ’´)} (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜_) t) (ÎºÂ° X âˆ˜ Ï) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® â„á´®) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (dist X id (ğ•‹ ğ’´)) (â…€â‚ {X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ â–¡ (ğ•‹ ğ’´)} (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜_) t)) (ÎºÂ° X âˆ˜ Ï)) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® â„á´®) (X âŠ¸ ğ•‹ ğ’´) - (ÎºÂ° X âˆ˜ Ï)) x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® â„á´®) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ l Ï â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ l) Ï}) t) (ÎºÂ° X âˆ˜ Ï)) x)
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (lstrâ‰ˆâ‚ (str-natâ‚ (ÎºÂ°á´®â‡’ X) (â…€â‚ (Î»{ l Ï x â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ l) Ï x}) t) Ï))  âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str â„á´® (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ h Ï â†’ h (ÎºÂ° X âˆ˜ Ï)}) (â…€â‚ (Î»{ l Ï â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ l) Ï}) t)) Ï) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str â„á´® (X âŠ¸ ğ•‹ ğ’´) - Ï) x))  âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str â„á´® (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ l Ï â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ l) (ÎºÂ° X âˆ˜ Ï)}) t) Ï) x)
    â‰¡âŸ¨âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str â„á´® (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ l Ï x â†’ âŠ¸â–¡ (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´) Ï (l x)}) t) Ï) x)
    âˆ }
  ; âŸ¨ğ‘£ğ‘ğ‘ŸâŸ© = Î»{ {Î“ = Î“}{v = v} â†’ dextÂ² Î» {Î”} Ï {Î˜} x â†’ begin
        ğ•£ğ•–ğ•Ÿ ğ’´ (ğ•§ğ•’ğ•£ ğ’´ (inl Î“ v)) (Ï âˆ£âˆ” Î˜)
    â‰¡âŸ¨ Renaming.ğ•¥âŸ¨ğ•§âŸ© ğ’´ âŸ©
        ğ•§ğ•’ğ•£ ğ’´ ((Ï âˆ£âˆ” Î˜) (inl Î“ v))
    â‰¡âŸ¨ cong (ğ•§ğ•’ğ•£ ğ’´) (âˆ”.injectâ‚ {f = inl _ âˆ˜ Ï}{g = inr _}) âŸ©
        ğ•§ğ•’ğ•£ ğ’´ (inl Î” (Ï v))
    âˆ }
  -- https://tinyurl.com/y362evek
  ; âŸ¨ğ‘šğ‘£ğ‘ğ‘ŸâŸ© = Î»{ {ğ”ª = l}{Îµ} â†’ dextÂ² Î» {Î”} Ï {Î˜} x â†’ begin
        dist X id (ğ•‹ ğ’´) (Î» x Ï â†’ ğ•£ğ•–ğ•Ÿ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) Îµ x) Ï) (ÎºÂ° X âˆ˜ Ï) x
    â‰¡âŸ¨âŸ©
        dist X id (ğ•‹ ğ’´) (dist X (ğ•§ğ•’ğ•£ ğ’´) (â–¡ (ğ•‹ ğ’´)) (Î» x â†’ ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x)) Îµ) (ÎºÂ° X âˆ˜ Ï) x
    â‰¡âŸ¨ Renaming.ğ•¥âŸ¨ğ•âŸ© ğ’´ âŸ©
        dist X id (ğ•‹ ğ’´) (dist X (ğ•§ğ•’ğ•£ ğ’´) (â–¡ (ğ•‹ ğ’´)) (Î» x Îµ Ï â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ ğ•£ğ•–ğ•Ÿ ğ’´ (Îµ v) Ï)) Îµ) (ÎºÂ° X âˆ˜ Ï) x
    â‰¡Ë˜âŸ¨ congr (dist-natâ‚‚ X {ğ’µ = â–¡ (ğ•‹ ğ’´)}(ğ•§ğ•’ğ•£ ğ’´) (Î» v Ï â†’ ğ•§ğ•’ğ•£ ğ’´ (Ï v)) (â–¡ (ğ•‹ ğ’´)) (ğ•£ğ•–ğ•Ÿ ğ’´) (Î» v â†’ Renaming.âŸ¨ğ•§âŸ© ğ’´) (Î»{ x Îµ Ï â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ Îµ v Ï)}) Îµ x)
               (Î» - â†’ - (copair â„ (Î» v â†’ ÎºÂ° X (Ï v) x) (inr Î”)))âŸ©
        dist {ğ’´ = â–¡ (ğ•‹ ğ’´)} X (Î» v Ï â†’ ğ•§ğ•’ğ•£ ğ’´ (Ï v)) (â–¡ (ğ•‹ ğ’´)) (Î» x Îµ Ï â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ Îµ v Ï)) (Î» v â†’ ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ Îµ v) x (copair â„ (Î» v â†’ ÎºÂ° X (Ï v) x) (inr Î”))
    â‰¡âŸ¨ dist-L {ğ’µ = ğ•‹ ğ’´} (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) id (ğ•§ğ•’ğ•£ ğ’´) (Î» v â†’ ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ Îµ v) (ÎºÂ° X âˆ˜ Ï) x âŸ©
        L (X âŠ¸ â„) (X âŠ¸ ğ•‹ ğ’´) (X âŠ¸ ğ•‹ ğ’´) (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l)) (Î» v â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ Îµ v)) (ÎºÂ° X âˆ˜ Ï) x
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) (Î» v x â†’ dist X id (ğ•‹ ğ’´) (ğ•£ğ•–ğ•Ÿ ğ’´ âˆ˜ Îµ v) (ÎºÂ° X âˆ˜ Ï) x) x
    âˆ }
  })
  where
  open â‰¡-Reasoning

ğ•ğ•¤ğ•¥ğ•£á´®â‡’ : Coalgâ‚šâ‡’ (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸á´® ğ•‹á´® ğ’´) ğ•ğ•¤ğ•¥ğ•£
ğ•ğ•¤ğ•¥ğ•£á´®â‡’ = record { áµ‡â‡’ = ğ•ğ•¤ğ•¥ğ•£áµ‡â‡’ ; âŸ¨Î·âŸ© = ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•§âŸ© }

-- Naturality for strength
ğ•ğ•¤ğ•¥ğ•£-natâ‚â‰ˆ : (f : X â‡¾ Y) â†’ MapEqâ‚€ (Y âŠ¸ ğ’´) (X âŠ¸ ğ•‹ ğ’´)
  (Î» t x â†’ ğ•ğ•¤ğ•¥ğ•£ {Y}{ğ’´} t (f x))
  (Î» t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) t) x)
ğ•ğ•¤ğ•¥ğ•£-natâ‚â‰ˆ {X}{Y}{ğ’´} f = record
  { áµƒ = SynAlgâ‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´}(_âˆ˜ f) (LinParamáµƒ (ğ•‹áµƒ ğ’´))
  ; fâŸ¨ğ‘£âŸ© = Î»{ {x = v} â†’ dext Î» x â†’ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v }
  ; fâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ {Y}{ğ’´} (ğ•ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’´) ğ”© Îµ) (f x)
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© ğ”© Îµ âŸ©
        dist Y (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) (f x)
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ ğ”© âˆ˜ f) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (Îµ v) âˆ˜ f) x
    âˆ }
  ; fâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext (Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ {Y}{ğ’´} (ğ•’ğ•ğ•˜ (Y âŠ¸ ğ’´) t) (f x)
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© t âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) (f x))
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (lstr-natâ‚ f (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ {Y âŠ¸ ğ•‹ ğ’´}{X âŠ¸ ğ•‹ ğ’´}(_âˆ˜ f) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (Y âŠ¸ ğ’´)}{Y âŠ¸ ğ•‹ ğ’´}{X âŠ¸ ğ•‹ ğ’´}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ (Î»{ t x â†’ ğ•ğ•¤ğ•¥ğ•£ t (f x) }) t) x)
    âˆ) }
  ; gâŸ¨ğ‘£âŸ© = Î»{ {x = v} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’´) v)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•§ğ•’ğ•£-nat {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) v) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v âŸ©
        ğ•§ğ•’ğ•£ ğ’´ (inl _ v)
    âˆ }
  ; gâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) (ğ•ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’´) ğ”© Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•§ğ•’ğ•£-nat {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) ğ”© Îµ) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) (ğ”© âˆ˜ f) (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) âˆ˜ Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© (ğ”© âˆ˜ f)(ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) âˆ˜ Îµ) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ ğ”© âˆ˜ f) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) âˆ˜ Îµ) x
    âˆ }
  ; gâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext (Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) (ğ•’ğ•ğ•˜ (Y âŠ¸ ğ’´) t)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•’ğ•ğ•˜-nat {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) t) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) (â…€â‚ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´}(_âˆ˜ f)) t)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© (â…€â‚ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´}(_âˆ˜ f)) t) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´}(_âˆ˜ f)) t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (Y âŠ¸ ğ’´)}{ğ•‹ (X âŠ¸ ğ’´)}{X âŠ¸ ğ•‹ ğ’´}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ( ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ {Y âŠ¸ ğ’´} {X âŠ¸ ğ’´} (_âˆ˜ f)) t) x)
    âˆ) }
  } where open â‰¡-Reasoning

ğ•ğ•¤ğ•¥ğ•£-natâ‚ : (f : X â‡¾ Y)(t : ğ•‹ (Y âŠ¸ ğ’´) Î± Î“)(x : X Î”)
        â†’ ğ•ğ•¤ğ•¥ğ•£ {Y}{ğ’´} t (f x)
        â‰¡ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {Y âŠ¸ ğ’´}{X âŠ¸ ğ’´} (_âˆ˜ f) t) x
ğ•ğ•¤ğ•¥ğ•£-natâ‚ {X}{Y}{ğ’´} f t x = cong (Î» - â†’ - x) (MapEqâ‚€.â‰ˆ (Y âŠ¸ ğ’´) (ğ•ğ•¤ğ•¥ğ•£-natâ‚â‰ˆ f) t)

ğ•ğ•¤ğ•¥ğ•£-natâ‚‚â‰ˆ : (g : ğ’´ â‡¾Ì£ ğ’µ) â†’ MapEqâ‚€ (X âŠ¸ ğ’´) (X âŠ¸ ğ•‹ ğ’µ)
  (Î» t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) t) x)
  (Î» t x â†’ ğ•‹â‚ g (ğ•ğ•¤ğ•¥ğ•£ t x))
ğ•ğ•¤ğ•¥ğ•£-natâ‚‚â‰ˆ {ğ’´}{ğ’µ}{X} g = record
  { áµƒ = LinParamáµƒ (record { ğ‘ğ‘™ğ‘” = ğ•’ğ•ğ•˜ ğ’µ ; ğ‘£ğ‘ğ‘Ÿ = ğ•§ğ•’ğ•£ ğ’µ ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Î» ğ”© â†’ ğ•ğ•§ğ•’ğ•£ ğ’µ (g ğ”©) })
  ; fâŸ¨ğ‘£âŸ© = Î»{ {Î“ = Î“}{x = v} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•§ğ•’ğ•£-nat {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) v)  âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’µ) v) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (inl Î“ v)
    âˆ }
  ; fâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) ğ”© Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•§ğ•’ğ•£-nat {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) (Î» {Ï„} x â†’ ğ”© {Ï„} x) Îµ) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’µ) (g âˆ˜ ğ”©) (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) âˆ˜ Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© (g âˆ˜ ğ”©) (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) âˆ˜ Îµ) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ g âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) âˆ˜ Îµ) x
    âˆ }
  ; fâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) t)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•’ğ•ğ•˜-nat {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) t) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’µ) (â…€â‚ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_)) t)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© (â…€â‚ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_)) t) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_)) t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {f = (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_))}{g = ğ•ğ•¤ğ•¥ğ•£}{x = t}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (â…€â‚ (Î»{ t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ} (g âˆ˜_) t) x }) t) x)
    âˆ }
  ; gâŸ¨ğ‘£âŸ© = Î»{ {Î“ = Î“}{x = v} â†’ dext Î» x â†’ begin
        ğ•‹â‚ g (ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) x)
    â‰¡âŸ¨ cong (ğ•‹â‚ g) (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v) âŸ©
        ğ•‹â‚ g (ğ•§ğ•’ğ•£ ğ’´ (inl Î“ v))
    â‰¡âŸ¨ ğ•§ğ•’ğ•£-nat g (inl Î“ v) âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (inl Î“ v)
    âˆ }
  ; gâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dext Î» x â†’ begin
        ğ•‹â‚ g (ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) ğ”© Îµ) x)
    â‰¡âŸ¨ cong (ğ•‹â‚ g) (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© ğ”© Îµ) âŸ©
        ğ•‹â‚ g (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x)
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’µ) (Î» x Îµ â†’ ğ•‹â‚ g (ğ•ğ•§ğ•’ğ•£ ğ’´ (ğ”© x) Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x
    â‰¡âŸ¨ ğ•ğ•§ğ•’ğ•£-nat g (ğ”© x) _ âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’µ) (Î» x Îµ â†’ ğ•ğ•§ğ•’ğ•£ ğ’µ (g (ğ”© x)) (ğ•‹â‚ g âˆ˜ Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x
    â‰¡Ë˜âŸ¨ dist-natâ‚‚ X (ğ•§ğ•’ğ•£ ğ’´) (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•‹â‚ g) (ğ•§ğ•’ğ•£-nat g) (ğ•ğ•§ğ•’ğ•£Â ğ’µ âˆ˜ g âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£Â ğ’µ âˆ˜ g âˆ˜ ğ”©) (Î» v â†’ ğ•‹â‚ g âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (Îµ v)) x
    âˆ }
  ; gâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext Î» x â†’ begin
        ğ•‹â‚ g (ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) t) x)
    â‰¡âŸ¨ cong (ğ•‹â‚ g) (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© t) âŸ©
        ğ•‹â‚ g (ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x))
    â‰¡âŸ¨ ğ•’ğ•ğ•˜-nat g (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (â…€â‚ (ğ•‹â‚ g) (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x))
    â‰¡Ë˜âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’µ) (lstr-natâ‚‚ (ğ•‹â‚ g) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (â…€â‚ {X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ ğ•‹ ğ’µ} (ğ•‹â‚ g âˆ˜_) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (X âŠ¸ ğ’´)}{X âŠ¸ ğ•‹ ğ’´}{X âŠ¸ ğ•‹ ğ’µ}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (â…€â‚ (Î»{ t x â†’ ğ•‹â‚ g (ğ•ğ•¤ğ•¥ğ•£ t x)}) t) x)
    âˆ }
  }
  where open â‰¡-Reasoning

ğ•ğ•¤ğ•¥ğ•£-natâ‚‚ : (g : ğ’´ â‡¾Ì£ ğ’µ)(t : ğ•‹ (X âŠ¸ ğ’´) Î± Î“)(x : X Î”)
        â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {X âŠ¸ ğ’´}{X âŠ¸ ğ’µ}(g âˆ˜_) t) x
        â‰¡ ğ•‹â‚ {ğ’´}{ğ’µ} g (ğ•ğ•¤ğ•¥ğ•£ t x)
ğ•ğ•¤ğ•¥ğ•£-natâ‚‚ {ğ’´}{ğ’µ}{X} g t x = cong (Î» - â†’ - x) (MapEqâ‚€.â‰ˆ (X âŠ¸ ğ’´) (ğ•ğ•¤ğ•¥ğ•£-natâ‚‚â‰ˆ g) t)

-- Interaction of strength and currying
ğ•ğ•¤ğ•¥ğ•£-curryâ‰ˆ : MapEqâ‚€ ((X âŠ— Y) âŠ¸ ğ’µ) (X âŠ¸ Y âŠ¸ ğ•‹ ğ’µ)
              (Î» t x y â†’ curryÂ° (ğ•‹ ğ’µ) (ğ•ğ•¤ğ•¥ğ•£ t) x y)
              (Î» t x y â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) t) x) y)
ğ•ğ•¤ğ•¥ğ•£-curryâ‰ˆ {X}{Y}{ğ’µ} = record
  { áµƒ = record
    { ğ‘ğ‘™ğ‘” = Î» l x y â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) l x) y)
    ; ğ‘£ğ‘ğ‘Ÿ = Î» v x y â†’ ğ•§ğ•’ğ•£ ğ’µ (ÎºÂ° Y (ÎºÂ° X v x) y)
    ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Î» ğ”© â†’ dist {ğ’´ = Y âŠ¸ ğ•‹ ğ’µ} X (Î» v â†’ ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° Y v) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (curryÂ° ã€– ğ•‹ ğ’µ , ğ•‹ ğ’µ ã€— (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ğ”©) x))
    }
  ; fâŸ¨ğ‘£âŸ© = Î»{ {Î“ = Î“}{x = v} â†’ dextÂ² (Î» {Î”} x {Î˜} y â†’ begin
        curryÂ° (ğ•‹ ğ’µ) (ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ ((X âŠ— Y) âŠ¸ ğ’µ) v)) x y
    â‰¡âŸ¨ curryÂ°â‰ˆâ‚ (Î» p â†’ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v {p}) âŸ©
        curryÂ° (ğ•‹ ğ’µ) (ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° (X âŠ— Y) v) x y
    â‰¡Ë˜âŸ¨ curryÂ°-natâ‚ƒ (ğ•§ğ•’ğ•£ ğ’µ) (ÎºÂ° (X âŠ— Y) v) x y âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (curryÂ° â„ (ÎºÂ° (X âŠ— Y) v) x y)
    â‰¡âŸ¨ cong (ğ•§ğ•’ğ•£ ğ’µ) (assocË¡â‰ˆâ†assocË¡ Î“ (ÎºÂ° (X âŠ— Y) v (x âŠ¹ y))) âŸ© --(copairâˆ˜inl â„ v) âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (â†assocË¡ Î“ Î” Î˜ (ÎºÂ° (X âŠ— Y) v (x âŠ¹ y)))
    â‰¡âŸ¨ cong (ğ•§ğ•’ğ•£ ğ’µ) (copairâˆ˜inl â„ v) âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (ÎºÂ° Y (ÎºÂ° X v x) y)
    âˆ) }
  ; fâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dextÂ² Î» x y â†’ begin
        curryÂ° (ğ•‹ ğ’µ) (ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ ((X âŠ— Y) âŠ¸ ğ’µ) ğ”© Îµ)) x y
    â‰¡âŸ¨ curryÂ°â‰ˆâ‚ (Î» p â†’ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© ğ”© Îµ {p}) âŸ©
        curryÂ° (ğ•‹ ğ’µ) (dist (X âŠ— Y) (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ)) x y
    â‰¡âŸ¨ dist-curryÂ° (ğ•§ğ•’ğ•£ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x y âŸ©
        dist {ğ’´ = Y âŠ¸ ğ•‹ ğ’µ} X (Î» v â†’ ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° Y v) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (curryÂ° ã€– ğ•‹ ğ’µ , ğ•‹ ğ’µ ã€— (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ğ”©) x)) (curryÂ° (ğ•‹ ğ’µ) âˆ˜ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x y
    âˆ}
  ; fâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dextÂ² (Î» x y â†’ begin
        curryÂ° (ğ•‹ ğ’µ) (ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ ((X âŠ— Y) âŠ¸ ğ’µ) t)) x y
    â‰¡âŸ¨ curryÂ°â‰ˆâ‚ (Î» p â†’ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© t {p}) âŸ©
        curryÂ° (ğ•‹ ğ’µ) (ğ•’ğ•ğ•˜ ğ’µ âˆ˜ lstr (ğ•‹ ğ’µ) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x y
    â‰¡Ë˜âŸ¨ curryÂ°-natâ‚ƒ (ğ•’ğ•ğ•˜ ğ’µ) (lstr (ğ•‹ ğ’µ) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x y âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (curryÂ° (â…€ (ğ•‹ ğ’µ)) (lstr (ğ•‹ ğ’µ) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x y)
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’µ) (lstr-curry (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x y) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr ((Y âŠ¸ ğ•‹ ğ’µ)) (â…€â‚ (curryÂ° (ğ•‹ ğ’µ)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x) y)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ ((X âŠ— Y) âŠ¸ ğ’µ)}{(X âŠ— Y) âŠ¸ ğ•‹ ğ’µ}{X âŠ¸ (Y âŠ¸ ğ•‹ ğ’µ)}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr ((Y âŠ¸ ğ•‹ ğ’µ)) - x) y)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) (â…€â‚ (curryÂ° (ğ•‹ ğ’µ) âˆ˜ ğ•ğ•¤ğ•¥ğ•£) t) x) y)
    âˆ) }
  ; gâŸ¨ğ‘£âŸ© = Î»{ {x = v} â†’ dextÂ² (Î» x y â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) (ğ•§ğ•’ğ•£ ((X âŠ— Y) âŠ¸ ğ’µ) v)) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•§ğ•’ğ•£-nat (curryÂ° ğ’µ) v)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ Y âŠ¸ ğ’µ) v) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ) (ÎºÂ° X v x)) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© (ÎºÂ° X v x) âŸ©
        ğ•§ğ•’ğ•£ ğ’µ (ÎºÂ° Y (ÎºÂ° X v x) y)
    âˆ
    ) }
  ; gâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = ğ”©}{Îµ} â†’ dextÂ² Î» x y â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) (ğ•ğ•§ğ•’ğ•£ ((X âŠ— Y) âŠ¸ ğ’µ) ğ”© Îµ)) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•§ğ•’ğ•£-nat (curryÂ° ğ’µ) ğ”© Îµ)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ Y âŠ¸ ğ’µ) (curryÂ° ğ’µ ğ”©) (ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ)) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© (curryÂ° ğ’µ ğ”©) (ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (dist {ğ’´ = ğ•‹ (Y âŠ¸ ğ’µ)} X (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ)) (ğ•‹ (Y âŠ¸ ğ’µ)) (ğ•ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ) âˆ˜ curryÂ° ğ’µ ğ”©) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ) x) y
    â‰¡âŸ¨âŸ©
        dist {ğ’´ = ğ•‹ (Y âŠ¸ ğ’µ)} X (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ)) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x â†’ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ) (curryÂ° ğ’µ ğ”© x)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ) x y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© (curryÂ° ğ’µ ğ”© x) _ âŸ©
        dist {ğ’´ = ğ•‹ (Y âŠ¸ ğ’µ)} X (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ)) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x Îµ â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ curryÂ° ğ’µ ğ”© x) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ) x y
    â‰¡Ë˜âŸ¨ cong (Î» - â†’ - y) (dist-natâ‚‚ {ğ’´ = ğ•‹ (Y âŠ¸ ğ’µ)} X {Y âŠ¸ ğ•‹ ğ’µ} (ğ•§ğ•’ğ•£ (Y âŠ¸ ğ’µ)) (Î» v â†’ ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° Y v) (Y âŠ¸ ğ•‹ ğ’µ) ğ•ğ•¤ğ•¥ğ•£ (Î» v â†’ dextâ€² (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v)) (Î» x â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ curryÂ° ğ’µ ğ”© x)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ (curryÂ° ğ’µ) âˆ˜ Îµ) x) âŸ©
        dist {ğ’´ = Y âŠ¸ ğ•‹ ğ’µ} X (Î» v â†’ ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° Y v) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ curryÂ° ğ’µ ğ”© x)) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) (Îµ v))) x y
    â‰¡âŸ¨ cong (Î» - â†’ - _) (curryÂ°-natâ‚ƒ {ğ’µ = ğ’µ}{ã€– ğ•‹ ğ’µ , ğ•‹ ğ’µ ã€—}(ğ•ğ•§ğ•’ğ•£ ğ’µ) ğ”© x y) âŸ©
        dist {ğ’´ = Y âŠ¸ ğ•‹ ğ’µ} X (Î» v â†’ ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ÎºÂ° Y v) (Y âŠ¸ ğ•‹ ğ’µ) (Î» x â†’ dist Y (ğ•§ğ•’ğ•£ ğ’µ) (ğ•‹ ğ’µ) (curryÂ° ã€– ğ•‹ ğ’µ , ğ•‹ ğ’µ ã€— (ğ•ğ•§ğ•’ğ•£ ğ’µ âˆ˜ ğ”©) x)) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) (Îµ v))) x y
    âˆ
   }
  ; gâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dextÂ² (Î» x y â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) (ğ•’ğ•ğ•˜ ((X âŠ— Y) âŠ¸ ğ’µ) t)) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•’ğ•ğ•˜-nat (curryÂ° ğ’µ) t)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ Y âŠ¸ ğ’µ) (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (Y âŠ¸ ğ’µ) (lstr (ğ•‹ (Y âŠ¸ ğ’µ)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x)) y
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•’âŸ© (lstr (ğ•‹ (Y âŠ¸ ğ’µ)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (lstr (ğ•‹ (Y âŠ¸ ğ’µ)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x)) y)
    â‰¡Ë˜âŸ¨ congr (lstr-natâ‚‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) - y)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) (â…€â‚ {X âŠ¸ ğ•‹ (Y âŠ¸ ğ’µ)} {X âŠ¸ Y âŠ¸ ğ•‹ ğ’µ} (ğ•ğ•¤ğ•¥ğ•£ âˆ˜_) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t))) x) y)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (X âŠ¸ Y âŠ¸ ğ’µ)}{X âŠ¸ ğ•‹ (Y âŠ¸ ğ’µ)}{X âŠ¸ Y âŠ¸ ğ•‹ ğ’µ}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) - x) y)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) (â…€â‚ {ğ•‹ (X âŠ¸ Y âŠ¸ ğ’µ)} {X âŠ¸ Y âŠ¸ ğ•‹ ğ’µ} (Î»{ t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ t x)}) (â…€â‚ (ğ•‹â‚ (curryÂ° ğ’µ)) t)) x) y)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ ((X âŠ— Y) âŠ¸ ğ’µ)}{ğ•‹ (X âŠ¸ Y âŠ¸ ğ’µ)}{X âŠ¸ Y âŠ¸ ğ•‹ ğ’µ}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) - x) y)) âŸ©
        ğ•’ğ•ğ•˜ ğ’µ (lstr (ğ•‹ ğ’µ) (lstr (Y âŠ¸ ğ•‹ ğ’µ) (â…€â‚ (Î» { t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) t) x) }) t) x) y)
    âˆ) }
  } where open â‰¡-Reasoning

ğ•ğ•¤ğ•¥ğ•£-curry : (t : ğ•‹ ((X âŠ— Y) âŠ¸ ğ’µ) Î± Î“)(x : X Î”)(y : Y Î˜)
         â†’ curryÂ° (ğ•‹ ğ’µ) (ğ•ğ•¤ğ•¥ğ•£ t) x y
         â‰¡ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ (curryÂ° ğ’µ) t) x) y
ğ•ğ•¤ğ•¥ğ•£-curry {X}{Y}{ğ’µ} t x y = cong (Î» - â†’ - x y) (MapEqâ‚€.â‰ˆ ((X âŠ— Y) âŠ¸ ğ’µ) ğ•ğ•¤ğ•¥ğ•£-curryâ‰ˆ t)

-- ğ•‹ is equipped with a linear strength
ğ•‹:LStr : LinStrength ğ•‹F
ğ•‹:LStr = record
  { lstr = Î» ğ’´ â†’ ğ•ğ•¤ğ•¥ğ•£
  ; lstr-natâ‚ = ğ•ğ•¤ğ•¥ğ•£-natâ‚
  ; lstr-natâ‚‚ = ğ•ğ•¤ğ•¥ğ•£-natâ‚‚
  ; lstr-curry = ğ•ğ•¤ğ•¥ğ•£-curry }
