
open import SOAS.Metatheory.Syntax

-- Strong monad of terms
module SOAS.Metatheory.SecondOrder.StrongMonad {T : Set}(Syn : Syntax {T}) where

open Syntax Syn

open import SOAS.Metatheory.FreeMonoid Syn
open import SOAS.Metatheory.TermFunctor Syn
open import SOAS.Metatheory.SecondOrder.Strength Syn
open import SOAS.Metatheory.SecondOrder.Monad Syn

open import SOAS.Common
open import SOAS.Families.Core {T}
open import SOAS.Context
open import SOAS.Variable
open import SOAS.Construction.Structure
open import SOAS.ContextMaps.Combinators
open import SOAS.ContextMaps.CategoryOfRenamings
open import SOAS.ContextMaps.Properties

open import SOAS.Abstract.Hom
open import SOAS.Abstract.Monoid

import SOAS.Abstract.Coalgebra as â†’â–¡
open â†’â–¡.Sorted
open â†’â–¡.Unsorted using (âŠ¤áµ‡) renaming (Coalg to UCoalg ; Coalgâ‡’ to UCoalgâ‡’ ; â–¡áµ‡ to â–¡áµ˜áµ‡)
import SOAS.Abstract.Box as â–¡ ; open â–¡.Sorted

-- open import Categories.Monad

-- open import SOAS.Coalgebraic.Monoid
-- open import SOAS.Coalgebraic.Map

-- open import SOAS.Metatheory.Coalgebraic
open import SOAS.Metatheory Syn

open import SOAS.Linear.Exponential
open import SOAS.Linear.Tensor
open import SOAS.Linear.Strength
open import SOAS.Linear.Distributor

open Theory
-- using (ğ•‹ ; SynAlg ; SynAlgâ‡’ ; module Semantics ; ğ•‹áµ‡ ; ğ•‹áµƒ ; ğ•‹áµ ; ğ•£ğ•–ğ•Ÿ ; ğ•¤ğ•–ğ•áµ‡â‡’)

private
  variable
    X Y Z : Family
    ğ’³ ğ’´ ğ’µ : Familyâ‚›
    Î“ Î” Î˜ Î : Ctx
    Î± Ï„ : T

-- Compatibility of strength and substitution
--                   ğ•¤ğ•¦ğ•“                                        ã€–id, ğ•ğ•¤ğ•¥ğ•£ã€—
--  ğ•‹ (X âŠ¸ ğ’´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ã€– ğ•‹ (X âŠ¸ ğ’´) , ğ•‹ (X âŠ¸ ğ’´) ã€— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ã€– ğ•‹ (X âŠ¸ ğ’´) , X âŠ¸ ğ•‹ ğ’´ ã€—
--       â•°â”€â”€â”€â”€â”€ X âŠ¸ ğ•‹ ğ’´ â”€â”€â”€â”€â”€â”€â”€â”€  X âŠ¸ ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— â”€â”€â”€â”€â”€â”€â”€ ã€– X âŠ¸ ğ•‹ ğ’´ , X âŠ¸ ğ•‹ ğ’´ ã€— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
--         ğ•ğ•¤ğ•¥ğ•£            X âŠ¸ ğ•¤ğ•¦ğ•“                       dist                            ã€–ğ•ğ•¤ğ•¥ğ•£, idã€—
--
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“â‰ˆ : MapEqâ‚ (X âŠ¸ ğ’´) {ğ’œ = X âŠ¸ ğ•‹ ğ’´}  (ğ•‹á´® (X âŠ¸ ğ’´)) (Î» t x â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) t x))
  (Î» t Ïƒ x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) t Ïƒ) x)
  (Î» t Ïƒ x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x)
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“â‰ˆ {X}{ğ’´} = record
  { Ï† = ğ•ğ•¤ğ•¥ğ•£
  ; Ï‡ = Î» l Îµ x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x)) Îµ x
  ; fâŸ¨ğ‘£âŸ© = Î»{ {Ïƒ = Ïƒ}{v} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) Ïƒ) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (Substitution.ğ•¥âŸ¨ğ•§âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x
    âˆ }
  ; fâŸ¨ğ‘šâŸ© = Î»{ {Ïƒ = Ïƒ}{l}{Îµ} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) l Îµ) Ïƒ) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (Substitution.ğ•¥âŸ¨ğ•âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) l (Î» v â†’ ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (Îµ v) Ïƒ)) x
    â‰¡âŸ¨ cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•âŸ© {ğ”ª = l} {Îµ = (Î» v â†’ ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (Îµ v) Ïƒ)}) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x)) (Î» p â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (Îµ p) Ïƒ)) x
    âˆ }
  ; fâŸ¨ğ‘âŸ© = Î»{ {Ïƒ = Ïƒ}{t} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) t) Ïƒ) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (Substitution.ğ•¥âŸ¨ğ•’âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (ğ•‹ (X âŠ¸ ğ’´)) (â…€â‚ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´)) t) Ïƒ)) x
    â‰¡âŸ¨ cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•’âŸ© {t = (str (ğ•‹á´® (X âŠ¸ ğ’´)) (ğ•‹ (X âŠ¸ ğ’´)) (â…€â‚ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´)) t) Ïƒ)}) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (str (ğ•‹á´® (X âŠ¸ ğ’´)) (ğ•‹ (X âŠ¸ ğ’´)) (â…€â‚ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´)) t) Ïƒ)) x)
    â‰¡Ë˜âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (lstrâ‰ˆâ‚ (str-natâ‚‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´)) t) Ïƒ)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ h Ïƒ â†’ ğ•ğ•¤ğ•¥ğ•£ (h Ïƒ)}) (â…€â‚ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´)) t)) Ïƒ) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) - Ïƒ) x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ t Ïƒ â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) t Ïƒ) }) t) Ïƒ) x)
    âˆ }
  ; gâŸ¨ğ‘£âŸ© = Î»{ {Ïƒ = Ïƒ}{v} â†’ dext Î» x â†’ begin
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥â‰ˆâ‚ ğ’´ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•§âŸ© {v = v})) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•§ğ•’ğ•£ ğ’´ (inl _ v))) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥âŸ¨ğ•§âŸ© ğ’´ âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x Ïƒ â†’ Ïƒ (inl _ v)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨âŸ©
        copair (ğ•‹ ğ’´) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr _) (inl _ v)
    â‰¡âŸ¨ copairâˆ˜inl (ğ•‹ ğ’´) v âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x
    âˆ }
    -- https://tinyurl.com/yansqvgw
  ; gâŸ¨ğ‘šâŸ© = Î»{ {Ïƒ = Ïƒ}{l}{Îµ} â†’ dext Î» x â†’ begin
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) l Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥â‰ˆâ‚ ğ’´ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•âŸ© {ğ”ª = l}{Îµ})) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (Î» x Îµ â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥âŸ¨ğ•âŸ© ğ’´ âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (Î» x Îµ Ïƒ â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ ğ•¤ğ•¦ğ•“ ğ’´ (Îµ v) Ïƒ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (Î» x Îµ Ïƒ â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ ğ•¤ğ•¦ğ•“ ğ’´ (Îµ v) Ïƒ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x (copair (ğ•‹ ğ’´) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr _))
    â‰¡Ë˜âŸ¨ congr (dist-natâ‚‚ X (ğ•§ğ•’ğ•£ ğ’´) (j (ğ•‹ ğ’´)) ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (ğ•¤ğ•¦ğ•“ ğ’´) (Î» v â†’ Substitution.âŸ¨ğ•§âŸ© ğ’´) (Î» x Ïƒ Îµ â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ Ïƒ v Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x) (Î» - â†’ - (copair (ğ•‹ ğ’´) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr _))) âŸ©
        dist {ğ’´ = ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} X (j (ğ•‹ ğ’´)) ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— ((Î» x Ïƒ Îµ â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ Ïƒ v Îµ))) (Î» p x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ (Îµ p) x)) x (copair (ğ•‹ ğ’´) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (Ïƒ v) x) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr _))
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ dist {ğ’´ = ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} X (j (ğ•‹ ğ’´)) (ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—) (Î» x Ïƒ Îµ â†’ ğ•ğ•§ğ•’ğ•£ ğ’´ (l x) (Î» v â†’ Ïƒ v Îµ)) (Î» p x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ (Îµ p) x)) x) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ dist-L {ğ’µ = ğ•‹ ğ’´} (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) (ğ•§ğ•’ğ•£ ğ’´) id (Î» p x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ (Îµ p) x)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x âŸ©
        L (X âŠ¸ ğ•‹ ğ’´) (X âŠ¸ ğ•‹ ğ’´) (X âŠ¸ ğ•‹ ğ’´) (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l)) (Î» p â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (Îµ p))) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) (Î» p â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (Îµ p)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ)) x
    âˆ }
  -- https://tinyurl.com/yc2z47jp
  ; gâŸ¨ğ‘âŸ© = Î»{ {Ïƒ = Ïƒ}{t} â†’ dext Î» x â†’ begin
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) t)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥â‰ˆâ‚ ğ’´ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•’âŸ© {t = t})) âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x))) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨ Substitution.ğ•¥âŸ¨ğ•’âŸ© ğ’´ âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x Ïƒ â†’ ğ•’ğ•ğ•˜ ğ’´ (str (ğ•‹á´® ğ’´) (ğ•‹ ğ’´) (â…€â‚ (ğ•¤ğ•¦ğ•“ ğ’´) (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x)) Ïƒ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
    â‰¡âŸ¨âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (â…€ (ğ•‹ ğ’´)) (Î» x Ïƒ â†’ str (ğ•‹á´® ğ’´) (ğ•‹ ğ’´) (â…€â‚ (ğ•¤ğ•¦ğ•“ ğ’´) (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x)) Ïƒ) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x)
    â‰¡Ë˜âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (strâ‰ˆâ‚ (lstr-natâ‚‚ (ğ•¤ğ•¦ğ•“ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (â…€ (ğ•‹ ğ’´)) (Î» x Ïƒ â†’ str (ğ•‹á´® ğ’´) (ğ•‹ ğ’´) (lstr ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (â…€â‚ {X âŠ¸ ğ•‹ ğ’´} {X âŠ¸ ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜_) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t)) x) Ïƒ) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (â…€ (ğ•‹ ğ’´)) (Î» x Ïƒ â†’ str (ğ•‹á´® ğ’´) (ğ•‹ ğ’´) (lstr ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— - x) Ïƒ) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x)) âŸ© --cong (ğ•’ğ•ğ•˜ ğ’´) (compat-strs (ğ•¤ğ•¦ğ•“á¶œ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (dist X (ğ•§ğ•’ğ•£ ğ’´) (â…€ (ğ•‹ ğ’´)) (Î» x Ïƒ â†’ str (ğ•‹á´® ğ’´) (ğ•‹ ğ’´) (lstr ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€— (â…€â‚ {ğ•‹ (X âŠ¸ ğ’´)} {X âŠ¸ ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} (Î» t x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x)) t) x) Ïƒ) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x)
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (compat-strs (ğ•‹á´® ğ’´) (â…€â‚ {ğ•‹ (X âŠ¸ ğ’´)} {X âŠ¸ ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} (Î» t x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x)) t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x) âŸ© --cong (ğ•’ğ•ğ•˜ ğ’´) (compat-strs (ğ•¤ğ•¦ğ•“á¶œ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® ğ•‹á´® ğ’´) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´)) (â…€â‚ {ğ•‹ (X âŠ¸ ğ’´)} {X âŠ¸ ã€– ğ•‹ ğ’´ , ğ•‹ ğ’´ ã€—} (Î» t x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x)) t)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ)) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® (ğ•‹á´® ğ’´)) (X âŠ¸ ğ•‹ ğ’´) - (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ)) x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (X âŠ¸á´® (ğ•‹á´® ğ’´)) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ t Ïƒ â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) Ïƒ}) t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ)) x)
    â‰¡âŸ¨ cong (ğ•’ğ•ğ•˜ ğ’´) (lstrâ‰ˆâ‚ (str-natâ‚ ğ•ğ•¤ğ•¥ğ•£á´®â‡’ (â…€â‚ (Î»{ t Ïƒ x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) Ïƒ x }) t) Ïƒ)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ {ã€– X âŠ¸ ğ•‹ ğ’´ , X âŠ¸ ğ•‹ ğ’´ ã€—} {ã€– ğ•‹ (X âŠ¸ ğ’´) , X âŠ¸ ğ•‹ ğ’´ ã€—}
                (Î» { h Ï‚ â†’ h (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ï‚) }) (â…€â‚ (Î»{ t Ïƒ â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) Ïƒ}) t)) Ïƒ) x)
    â‰¡Ë˜âŸ¨ congr â…€.homomorphism (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) - Ïƒ) x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (str (ğ•‹á´® (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (Î»{ t Ïƒ â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) }) t) Ïƒ) x)
    âˆ }
  }

  where open â‰¡-Reasoning

ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“ : (t : ğ•‹ (X âŠ¸ ğ’´) Î± Î“)(Ïƒ : Î“ ~[ ğ•‹ (X âŠ¸ ğ’´) ]â† Î”)(x : X Î˜)
      â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) t Ïƒ) x
      â‰¡ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Ïƒ) x
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“ t Ïƒ x = cong (Î» - â†’ - x) (MapEqâ‚.â‰ˆ _ ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“â‰ˆ t)

-- Compatibility of monad multiplication and strength
--                      ğ•›ğ• ğ•šğ•Ÿ                     ğ•ğ•¤ğ•¥ğ•£
--  ğ•‹ (ğ•‹ (X âŠ¸ ğ’´)) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ğ•‹ (X âŠ¸ ğ’´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ X âŠ¸ ğ•‹ ğ’´
--       â•°â”€â”€â”€â”€â”€â”€â”€ ğ•‹ (X âŠ¸ ğ•‹ ğ’´) â”€â”€â”€â”€â”€â”€ X âŠ¸ ğ•‹ (ğ•‹ ğ’´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
--         ğ•‹ ğ•ğ•¤ğ•¥ğ•£                 ğ•ğ•¤ğ•¥ğ•£                 X âŠ¸ ğ•›ğ• ğ•šğ•Ÿ
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•›ğ• ğ•šğ•Ÿâ‰ˆ : MapEqâ‚€ (ğ•‹ (X âŠ¸ ğ’´)) (X âŠ¸ ğ•‹ ğ’´)
  (Î» t x â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•›ğ• ğ•šğ•Ÿ t) x)
  (Î» t x â†’ ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ t) x))
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•›ğ• ğ•šğ•Ÿâ‰ˆ {X}{ğ’´} = record
  { áµƒ = record { ğ‘ğ‘™ğ‘” = Î» t x â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) t x)
               ; ğ‘£ğ‘ğ‘Ÿ = Î» v x â†’ ğ•§ğ•’ğ•£ ğ’´ (inl _ v)
               ; ğ‘šğ‘£ğ‘ğ‘Ÿ = Î» t Îµ x â†’ dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x)) Îµ x }
  ; fâŸ¨ğ‘£âŸ© = Î»{ {Î“ = Î“}{x = v} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•›ğ• ğ•šğ•Ÿ (ğ•§ğ•’ğ•£ (ğ•‹ (X âŠ¸ ğ’´)) v)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (âŸ¨ğ•§âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) x
    â‰¡âŸ¨ cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•§âŸ© {v = v}) âŸ©
        ğ•§ğ•’ğ•£ ğ’´ (inl Î“ v)
    âˆ }
  ; fâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = t}{Îµ} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•§ğ•’ğ•£ (ğ•‹ (X âŠ¸ ğ’´)) t Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (âŸ¨ğ•âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•¤ğ•¦ğ•“ (X âŠ¸ ğ’´) t (ğ•›ğ• ğ•šğ•Ÿ âˆ˜ Îµ)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¤ğ•¦ğ•“ t (ğ•›ğ• ğ•šğ•Ÿ âˆ˜ Îµ) x âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (Î» x â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•›ğ• ğ•šğ•Ÿ âˆ˜ Îµ) x
    âˆ }
  ; fâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext Î» x â†’ begin
        ğ•ğ•¤ğ•¥ğ•£ (ğ•›ğ• ğ•šğ•Ÿ (ğ•’ğ•ğ•˜ (ğ•‹ (X âŠ¸ ğ’´)) t)) x
    â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (âŸ¨ğ•’âŸ© (X âŠ¸ ğ’´)) âŸ©
        ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ’´) (â…€â‚ ğ•›ğ• ğ•šğ•Ÿ t)) x
    â‰¡âŸ¨ cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•’âŸ© {t = â…€â‚ ğ•›ğ• ğ•šğ•Ÿ t}) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ ğ•›ğ• ğ•šğ•Ÿ t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {f = ğ•›ğ• ğ•šğ•Ÿ}{ğ•ğ•¤ğ•¥ğ•£}{x = t}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•›ğ• ğ•šğ•Ÿ) t) x)
    âˆ }
  ; gâŸ¨ğ‘£âŸ© = Î»{ {Î“ = Î“}{x = v} â†’ dext Î» x â†’ begin
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (ğ•‹ (X âŠ¸ ğ’´)) v)) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•§ğ•’ğ•£-nat ğ•ğ•¤ğ•¥ğ•£ v)) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ•‹ ğ’´) v) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•§âŸ© {v = v})) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (ğ•§ğ•’ğ•£ (ğ•‹ ğ’´) (inl Î“ v))
    â‰¡âŸ¨ âŸ¨ğ•§âŸ© ğ’´ âŸ©
        ğ•§ğ•’ğ•£ ğ’´ (inl Î“ v)
    âˆ }
  ; gâŸ¨ğ‘šâŸ© = Î»{ {ğ”ª = t}{Îµ} â†’ dext Î» x â†’ begin
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (ğ•‹ (X âŠ¸ ğ’´)) t Îµ)) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•ğ•§ğ•’ğ•£-nat ğ•ğ•¤ğ•¥ğ•£ t Îµ)) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ•‹ ğ’´) (ğ•ğ•¤ğ•¥ğ•£ t) (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ)) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•âŸ© {ğ”ª = ğ•ğ•¤ğ•¥ğ•£ t}{Îµ = ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ})) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (dist X (ğ•§ğ•’ğ•£ (ğ•‹ ğ’´)) (ğ•‹ (ğ•‹ ğ’´)) (Î» x Îµ â†’ ğ•ğ•§ğ•’ğ•£ (ğ•‹ ğ’´) (ğ•ğ•¤ğ•¥ğ•£ t x) Îµ) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x)
    â‰¡âŸ¨âŸ©
        dist X (ğ•§ğ•’ğ•£ (ğ•‹ ğ’´)) (ğ•‹ ğ’´) (Î» x Îµ â†’ ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•§ğ•’ğ•£ (ğ•‹ ğ’´) (ğ•ğ•¤ğ•¥ğ•£ t x) Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x
    â‰¡âŸ¨ âŸ¨ğ•âŸ© ğ’´ âŸ©
        dist X (ğ•§ğ•’ğ•£ (ğ•‹ ğ’´)) (ğ•‹ ğ’´) (Î» x Îµ â†’ ğ•¤ğ•¦ğ•“ ğ’´ (ğ•ğ•¤ğ•¥ğ•£ t x) (ğ•›ğ• ğ•šğ•Ÿ âˆ˜ Îµ)) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x
    â‰¡Ë˜âŸ¨ dist-natâ‚‚ X (ğ•§ğ•’ğ•£ (ğ•‹ ğ’´)) (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) ğ•›ğ• ğ•šğ•Ÿ (Î» v â†’ âŸ¨ğ•§âŸ© ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ âˆ˜ Îµ) x âŸ©
        dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•¤ğ•¦ğ•“ ğ’´ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ t) (Î» v â†’ ğ•›ğ• ğ•šğ•Ÿ âˆ˜ ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ (Îµ v))) x
    âˆ }
  ; gâŸ¨ğ‘âŸ© = Î»{ {t = t} â†’ dext Î» x â†’ begin
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (ğ•‹ (X âŠ¸ ğ’´)) t)) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£â‰ˆâ‚ (ğ•’ğ•ğ•˜-nat ğ•ğ•¤ğ•¥ğ•£ t)) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•’ğ•ğ•˜ (X âŠ¸ ğ•‹ ğ’´) (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t)) x)
    â‰¡âŸ¨ cong ğ•›ğ• ğ•šğ•Ÿ (cong (Î» - â†’ - x) (ğ•ƒğ•Šğ•¥ğ•£.âŸ¨ğ•’âŸ© {t = â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t})) âŸ©
        ğ•›ğ• ğ•šğ•Ÿ (ğ•’ğ•ğ•˜ (ğ•‹ ğ’´) (lstr (ğ•‹ (ğ•‹ ğ’´)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t)) x))
    â‰¡âŸ¨ âŸ¨ğ•’âŸ© ğ’´ âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (â…€â‚ ğ•›ğ• ğ•šğ•Ÿ (lstr (ğ•‹ (ğ•‹ ğ’´)) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t)) x))
    â‰¡Ë˜âŸ¨Â cong (ğ•’ğ•ğ•˜ ğ’´) (lstr-natâ‚‚ ğ•›ğ• ğ•šğ•Ÿ (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t)) x) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ (Î»{ l x â†’ ğ•›ğ• ğ•šğ•Ÿ (l x) }) (â…€â‚ ğ•ğ•¤ğ•¥ğ•£ (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t))) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (X âŠ¸ ğ•‹ ğ’´)}{X âŠ¸ ğ•‹ (ğ•‹ ğ’´)}{X âŠ¸ ğ•‹ ğ’´}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ (Î»{ t x â†’ ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ t x) }) (â…€â‚ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£) t)) x)
    â‰¡Ë˜âŸ¨ congr (â…€.homomorphism {ğ•‹ (ğ•‹ (X âŠ¸ ğ’´))}{ğ•‹ (X âŠ¸ ğ•‹ ğ’´)}{X âŠ¸ ğ•‹ ğ’´}) (Î» - â†’ ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) - x)) âŸ©
        ğ•’ğ•ğ•˜ ğ’´ (lstr (ğ•‹ ğ’´) (â…€â‚ (Î»{ t x â†’ ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ ğ•ğ•¤ğ•¥ğ•£ t) x)}) t) x)
    âˆ }
  }
  where
  open â‰¡-Reasoning
  open Join

ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•›ğ• ğ•šğ•Ÿ : (t : ğ•‹ (ğ•‹ (X âŠ¸ ğ’´)) Î± Î“)(x : X Î”)
       â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•›ğ• ğ•šğ•Ÿ t) x â‰¡ ğ•›ğ• ğ•šğ•Ÿ (ğ•ğ•¤ğ•¥ğ•£ (ğ•‹â‚ {ğ•‹ (X âŠ¸ ğ’´)}{X âŠ¸ ğ•‹ ğ’´} ğ•ğ•¤ğ•¥ğ•£ t) x)
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•›ğ• ğ•šğ•Ÿ {X}{ğ’´} t x = cong (Î» - â†’ - x) (MapEqâ‚€.â‰ˆ (ğ•‹ (X âŠ¸ ğ’´)) ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•›ğ• ğ•šğ•Ÿâ‰ˆ t)

-- Compatibility of strength and monad unit
--          ğ•¦ğ•Ÿğ•šğ•¥             ğ•ğ•¤ğ•¥ğ•£
--  X âŠ¸ ğ’´ â”€â”€â”€â”€â”€ ğ•‹ (X âŠ¸ ğ’´) â”€â”€â”€â”€â”€ X âŠ¸ ğ•‹ ğ’´
--    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
--               X âŠ¸ ğ•¦ğ•Ÿğ•šğ•¥
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¦ğ•Ÿğ•šğ•¥ : (l : (X âŠ¸ ğ’´) Î± Î“)(x : X Î”)
       â†’ ğ•ğ•¤ğ•¥ğ•£ {ğ’´ = ğ’´} (ğ•¦ğ•Ÿğ•šğ•¥ {X âŠ¸ ğ’´} l) x â‰¡ ğ•¦ğ•Ÿğ•šğ•¥ (l x)
ğ•ğ•¤ğ•¥ğ•£âˆ˜ğ•¦ğ•Ÿğ•šğ•¥ {X}{ğ’´}{Î±}{Î“}{Î”} l x = begin
      ğ•ğ•¤ğ•¥ğ•£ {ğ’´ = ğ’´} (ğ•¦ğ•Ÿğ•šğ•¥ {X âŠ¸ ğ’´} l) x
  â‰¡âŸ¨âŸ©
      ğ•ğ•¤ğ•¥ğ•£ {ğ’´ = ğ’´} (ğ•ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) l (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´))) x
  â‰¡âŸ¨ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•âŸ© l (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´)) âŸ©
      dist X (ğ•§ğ•’ğ•£ ğ’´) (ğ•‹ ğ’´) (ğ•ğ•§ğ•’ğ•£ ğ’´ âˆ˜ l) (ğ•ğ•¤ğ•¥ğ•£ âˆ˜ ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´)) x
  â‰¡âŸ¨ SynAlg.ğ‘šâ‰ˆâ‚‚ ğ’´ (ğ•‹áµƒ ğ’´) (Î» v â†’ begin
        copair (ğ•‹ ğ’´) (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£ (ğ•§ğ•’ğ•£ (X âŠ¸ ğ’´) v) x) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr Î“) v
    â‰¡âŸ¨ copairâ‰ˆâ‚ (ğ•‹ ğ’´) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr Î“) {v} (Î» v â†’ ğ•ğ•¤ğ•¥ğ•£âŸ¨ğ•§âŸ© v)  âŸ©
        copair (ğ•‹ ğ’´) (Î» v â†’ ğ•§ğ•’ğ•£ ğ’´ (ÎºÂ° X v x)) (ğ•§ğ•’ğ•£ ğ’´ âˆ˜ inr Î“) v
    â‰¡Ë˜âŸ¨ fâˆ˜copair â„ (ğ•§ğ•’ğ•£ ğ’´) (inl Î“) (inr Î“) v âŸ©
        ğ•§ğ•’ğ•£ ğ’´ (copair â„ (inl Î“) (inr Î“) v)
    â‰¡âŸ¨ cong (ğ•§ğ•’ğ•£ ğ’´) (copair-Î· Î“ Î” v) âŸ©
        ğ•§ğ•’ğ•£ ğ’´ v
    âˆ) âŸ©
      ğ•¦ğ•Ÿğ•šğ•¥ (l x)
  âˆ where open â‰¡-Reasoning
