
-- Equational theory of partial differentiation
module PDiff.Equality where

open import SOAS.Common hiding (_Ã—_)
open import SOAS.Context
open import SOAS.Variable
open import SOAS.Families.Core
open import SOAS.Families.Build
open import SOAS.ContextMaps.Inductive

open import PDiff.Signature
open import PDiff.Syntax

open import SOAS.Metatheory.SecondOrder.Metasubstitution PD:Syn
open import SOAS.Metatheory.SecondOrder.Equality PD:Syn
open import SOAS.Metatheory

open PD:Syntax
open import SOAS.Syntax.Shorthands PDáµƒ

private
  variable
    Î± Î² Î³ Ï„ : *T
    Î“ Î” Î  : Ctx

-- Axioms of rings and partial differentiation
data Axiom : (ğ” : MCtx)(Î“ : Ctx){Î± : *T} â†’ (ğ” â–· PD) Î± Î“ â†’ (ğ” â–· PD) Î± Î“ â†’ Set where
  ğŸ˜LU : Axiom (âŠª *) âˆ… (ğŸ˜ + ğ” âŸ¨âŸ©) (ğ” âŸ¨âŸ©)
  ğŸ˜RU : Axiom (âŠª *) âˆ… (ğ” âŸ¨âŸ© + ğŸ˜) (ğ” âŸ¨âŸ©)
  ğŸ˜LA : Axiom (âŠª *) âˆ… (ğŸ˜ Ã— ğ” âŸ¨âŸ©) (ğŸ˜)
  +LI : Axiom (âŠª *) âˆ… (â€“ (ğ” âŸ¨âŸ©) + ğ” âŸ¨âŸ©) (ğŸ˜)
  +C : Axiom (âŠ© * â‰€ âŠª *) âˆ… (ğ” âŸ¨âŸ© + ğ”Ÿ âŸ¨âŸ©) (ğ”Ÿ âŸ¨âŸ© + ğ” âŸ¨âŸ©)
  +A : Axiom (âŠ© * â‰€ âŠ© * â‰€ âŠª *) âˆ…
        ((ğ” âŸ¨âŸ© + ğ”Ÿ âŸ¨âŸ©) + ğ”  âŸ¨âŸ©) (ğ” âŸ¨âŸ© + (ğ”Ÿ âŸ¨âŸ© + ğ”  âŸ¨âŸ©))
  ğŸ™LU : Axiom (âŠª *) âˆ… (ğŸ™ Ã— ğ” âŸ¨âŸ©) (ğ” âŸ¨âŸ©)
  ğŸ™RU : Axiom (âŠª *) âˆ… (ğ” âŸ¨âŸ© Ã— ğŸ™) (ğ” âŸ¨âŸ©)
  Ã—C : Axiom (âŠ© * â‰€ âŠª *) âˆ… (ğ” âŸ¨âŸ© Ã— ğ”Ÿ âŸ¨âŸ©) (ğ”Ÿ âŸ¨âŸ© Ã— ğ” âŸ¨âŸ©)
  Ã—A : Axiom (âŠ© * â‰€ âŠ© * â‰€ âŠª *) âˆ…
        ((ğ” âŸ¨âŸ© Ã— ğ”Ÿ âŸ¨âŸ©) Ã— ğ”  âŸ¨âŸ©) (ğ” âŸ¨âŸ© Ã— (ğ”Ÿ âŸ¨âŸ© Ã— ğ”  âŸ¨âŸ©))
  LD : Axiom (âŠ© * â‰€ âŠ© * â‰€ âŠª *) âˆ…
          (ğ” âŸ¨âŸ© Ã— (ğ”Ÿ âŸ¨âŸ© + ğ”  âŸ¨âŸ©)) ((ğ” âŸ¨âŸ© Ã— ğ”Ÿ âŸ¨âŸ©) + (ğ” âŸ¨âŸ© Ã— ğ”  âŸ¨âŸ©))
  RD : Axiom (âŠ© * â‰€ âŠ© * â‰€ âŠª *) âˆ…
          ((ğ” âŸ¨âŸ© + ğ”Ÿ âŸ¨âŸ©) Ã— ğ”  âŸ¨âŸ©) ((ğ” âŸ¨âŸ© Ã— ğ”  âŸ¨âŸ©) + (ğ”Ÿ âŸ¨âŸ© Ã— ğ”  âŸ¨âŸ©))

  âˆ‚+ : Axiom (âŠª *) (âŒŠ * âŒ‹) (âˆ‚â‚€ (xâ‚€ + ğ” âŸ¨âŸ©)) ğŸ™
  âˆ‚Ã— : Axiom (âŠª *) (âŒŠ * âŒ‹) (âˆ‚â‚€ (ğ”Â âŸ¨âŸ© Ã— xâ‚€)) (ğ”Â âŸ¨âŸ©)
  âˆ‚com : Axiom (âŒŠ * âˆ™ * âŒ‹ âŠª *) (âŒŠ * âˆ™ * âŒ‹)
    (âˆ‚â‚ (âˆ‚â‚€ (ğ” âŸ¨ xâ‚€ â—‚ xâ‚ âŸ©)))
    (âˆ‚â‚€ (âˆ‚â‚ (ğ” âŸ¨ xâ‚€ â—‚ xâ‚ âŸ©)))
  âˆ‚CHâ‚‚ : Axiom (âŒŠ * âˆ™ * âŒ‹ âŠ© * â‰€ âŒŠ * âŒ‹ âŠ© * â‰€ âŒŠ * âŒ‹ âŠª *) (âŒŠ * âŒ‹)
    (âˆ‚â‚€ (ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©) â—‚ (ğ”  âŸ¨ xâ‚€ âŸ©) âŸ©))
    ( (âˆ‚ (ğ” âŸ¨ xâ‚€ â—‚ (ğ”  âŸ¨ xâ‚ âŸ©) âŸ©) âˆ£ ğ”Ÿ âŸ¨ xâ‚€ âŸ©) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
    + (âˆ‚ (ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚ âŸ©) â—‚ xâ‚€ âŸ©) âˆ£ ğ”  âŸ¨ xâ‚€ âŸ©) Ã— (âˆ‚â‚€ (ğ”  âŸ¨ xâ‚€ âŸ©)))

open EqLogic Axiom
open â‰‹-Reasoning

-- Derivative of a variable is 1
âˆ‚id : â—¾ â–¹ âŒŠ * âŒ‹ âŠ¢ âˆ‚â‚€ xâ‚€ â‰‹ ğŸ™
âˆ‚id = begin
      âˆ‚â‚€ xâ‚€      â‰‹âŸ¨ cong[ ax ğŸ˜RU withã€Š xâ‚€ ã€‹ ]inside (âˆ‚â‚€ â—Œ) âŸ©â‚›
      âˆ‚â‚€ xâ‚€ + ğŸ˜  â‰‹âŸ¨ ax âˆ‚+ withã€Š ğŸ˜ ã€‹ âŸ©
      ğŸ™          âˆ

-- Right annihilation law
ğŸ˜RA : âŠª * â–¹ âˆ… âŠ¢ ğ” âŸ¨âŸ© Ã— ğŸ˜ â‰‹ ğŸ˜
ğŸ˜RA = tr (ax Ã—C withã€Š ğ” âŸ¨âŸ© â—ƒ ğŸ˜ ã€‹) (ax ğŸ˜LA withã€Š ğ” âŸ¨âŸ© ã€‹)

-- Derivative of 0 is 0
âˆ‚ğŸ˜ : â—¾ â–¹ âŒŠ * âŒ‹ âŠ¢ âˆ‚â‚€ ğŸ˜ â‰‹ ğŸ˜
âˆ‚ğŸ˜ = begin
      âˆ‚â‚€ ğŸ˜         â‰‹âŸ¨ cong[ ax ğŸ˜LA withã€Š xâ‚€ ã€‹ ]inside âˆ‚â‚€ â—Œ âŸ©â‚›
      âˆ‚â‚€ (ğŸ˜ Ã— xâ‚€)  â‰‹âŸ¨ ax âˆ‚Ã— withã€Š ğŸ˜ ã€‹ âŸ©
      ğŸ˜            âˆ

-- Unary chain rule
âˆ‚CHâ‚ : âŒŠ * âŒ‹ âŠ© * â‰€ âŒŠ * âŒ‹ âŠª * â–¹ (âŒŠ * âŒ‹)
  âŠ¢ âˆ‚â‚€ (ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©) âŸ©)
  â‰‹ (âˆ‚ ğ” âŸ¨ xâ‚€ âŸ© âˆ£ ğ”Ÿ âŸ¨ xâ‚€ âŸ©) Ã— (âˆ‚â‚€ ğ”Ÿ âŸ¨ xâ‚€ âŸ©)
âˆ‚CHâ‚ = begin
      âˆ‚â‚€ (ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©) âŸ©)
  â‰‹âŸ¨ ax  âˆ‚CHâ‚‚ withã€Š ğ” âŸ¨ xâ‚€ âŸ© â—ƒ ğ”Ÿ âŸ¨ xâ‚€ âŸ© â—ƒ ğŸ˜ ã€‹ âŸ©
      (âˆ‚ ğ” âŸ¨ xâ‚€ âŸ© âˆ£ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
    + (âˆ‚ ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚ âŸ©) âŸ© âˆ£ ğŸ˜) Ã— (âˆ‚â‚€ ğŸ˜)
  â‰‹âŸ¨ cong[ thm âˆ‚ğŸ˜ ]inside (âˆ‚ â†‘ ğ” âŸ¨ xâ‚€ âŸ© âˆ£ (â†‘ ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (â†‘ ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
                          + (âˆ‚ â†‘ ğ” âŸ¨ (â†‘ ğ”Ÿ âŸ¨ xâ‚ âŸ©) âŸ© âˆ£ ğŸ˜) Ã— â—Œ âŸ©
      (âˆ‚ ğ” âŸ¨ xâ‚€ âŸ© âˆ£ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
    + (âˆ‚ ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚ âŸ©) âŸ© âˆ£ ğŸ˜) Ã— ğŸ˜
  â‰‹âŸ¨ cong[ thm ğŸ˜RA withã€Š (âˆ‚ ğ” âŸ¨ (ğ”Ÿ âŸ¨ xâ‚ âŸ©) âŸ© âˆ£ ğŸ˜) ã€‹ ]inside (âˆ‚ â†‘ ğ” âŸ¨ xâ‚€ âŸ© âˆ£ (â†‘ ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (â†‘ ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) + â—Œ âŸ©
      (âˆ‚ (ğ” âŸ¨ xâ‚€ âŸ©) âˆ£ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
    + ğŸ˜
  â‰‹âŸ¨ ax ğŸ˜RU withã€Š (âˆ‚ (ğ” âŸ¨ xâ‚€ âŸ©) âˆ£ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) ã€‹ âŸ©
      (âˆ‚ (ğ” âŸ¨ xâ‚€ âŸ©) âˆ£ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©)) Ã— (âˆ‚â‚€ (ğ”Ÿ âŸ¨ xâ‚€ âŸ©))
  âˆ
